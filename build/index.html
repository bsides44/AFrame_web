<html>

	<head>
		<script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
		<script src="https://raw.githack.com/AR-js-org/AR.js/3.4.0/aframe/build/aframe-ar.js"></script>
		<!-- animation -->
		<script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
		<!-- NB: WebXR features like hit testing don't currently work on iOS -->
		<script>
		AFRAME.registerComponent('hide-in-ar-mode', {
			init: function () {
				// enter-vr is for both xr options
				this.el.sceneEl.addEventListener('enter-vr', (ev) => {
					if (this.el.sceneEl.is('ar-mode')) {
						this.el.setAttribute('visible', false);
					}
				});
					this.el.sceneEl.addEventListener('exit-vr', (ev) => {
					this.el.setAttribute('visible', true);
				});
			}
			})

		AFRAME.registerComponent("hide-on-hit-test-start", {
			init: function() {
				
				this.el.sceneEl.addEventListener("ar-hit-test-start", function(ev) {
					ev.target.object3D.visible = false;
				});
				this.el.sceneEl.addEventListener('ar-hit-test-select', (ev) => {
					ev.target.object3D.visible = true;
					ev.target.object3D.position = ev.detail.position;
				});
				this.el.sceneEl.addEventListener("exit-vr", function() {
					ev.target.object3D.visible = true;
				});
			}
		  });
		  </script>
		  <style>
			.a-enter-ar{
				position: fixed !important;
				right: 80px !important;
			}
		  </style>
	</head>

	<body>
			<a-scene embedded arjs
				webxr="overlayElement:#dom-overlay; optionalFeatures:hit-test;" 
				ar-hit-test="target:#me-gltf;"
				reflection="directionalLight:#dirlight;"
				shadow="type: pcfsoft"
				raycaster="objects: #me-gltf"
				> 
			<a-assets>
				<a-asset-item id="me-gltf" src="./Maddy_20k.gltf" response-type="arraybuffer"></a-asset-item>
				<a-asset-item id="reticle" src="./reticle.gltf" response-type="arraybuffer"></a-asset-item>
			</a-assets>

			<!-- black screen without position -->
				<a-entity hide-on-hit-test-start
							position="-1 0.5 -3" 
							rotation="0 55 0"
							gltf-model="#me-gltf"
							animation-mixer="loop:repeat"
							shadow="cast: true; receive: false"></a-entity>
		
			<a-entity light="type: hemisphere; intensity: 10"></a-entity>
			<a-light type="directional"
				light="intensity: 10;
					castShadow: true;
						shadowMapHeight: 1024;
						shadowMapWidth: 1024;
						shadowCameraLeft: -7;
						shadowCameraRight: 5;
						shadowCameraBottom: -5;
						shadowCameraTop: 5;"
				id="dirlight"
				target="me-gltf"
				position="-2 4 2">
   			</a-light>
			   <a-camera position="0 1.2 0"></a-camera>
		</a-scene>
	</body>

</html>